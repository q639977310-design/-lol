local Translations = {
    ["Katchi Hub v2.1"] = "Katchi Hub v2.1",
    ["Professional Guts & BlackPowder Script Hub"] = "专业的新版与瞎子脚本中心",
    ["Made by Yuki and ziaan"] = "由Yuki和ziaan制作汉化by法兰西入",
    ["Executor"] = "执行器",
    ["Changelogs"] = "更新日志",
    ["New Features!"] = "新功能！",
    ["Kill Aura!"] = "自动攻击！",
    ["Dracula (New)"] = "德古拉模式（新增）",
    ["Community"] = "社区",
    ["Join Our Discord"] = "加入我们的Discord",
    ["Get support, updates, and connect with other Katchi Hub users!"] = "获取支持、更新，并与其他Katchi Hub用户交流！",
    ["Click the button below to copy our Discord invite link."] = "点击下方按钮复制我们的Discord邀请链接",
    ["Search"] = "搜索",
    ["Dashboard"] = "控制面板",
    ["Main"] = "主功能",
    ["Aiming"] = "瞄准",
    ["Head Hit"] = "头部命中",
    ["Aimlock Bomber"] = "牢自爆自动瞄准",
    ["Range (studs)"] = "范围（单位：stud）",
    ["Smoothness (lower = faster)"] = "平滑度（数值越低=速度越快）",
    ["Legit Thingys"] = "常规功能",
    ["Auto Jump"] = "自动跳跃",
    ["Hitbox Expander"] = "碰撞箱扩展",
    ["Hitbox Zombie Size"] = "碰撞箱僵尸尺寸",
    ["Hitbox Zombie Range"] = "碰撞箱僵尸范围",
    ["ESP & Zombie Alerts"] = "ESP与僵尸警报",
    ["Warns when a Cuirassier Zombie is charging"] = "牢骑兵冲锋时发出警告",
    ["Highlights zombies with Eye but no Axe and marks as Runner"] = "高亮显示有眼睛无斧头的并标记",
    ["Highlights zombies with Axe and marks as Zapper"] = "高亮显示有斧头的并标记",
    ["Highlights Igniter zombies"] = "高亮显示老兵烧烤",
    ["Kill Aura"] = "自动攻击",
    ["Kill Aura Range"] = "自动攻击范围",
    ["Attack Speed"] = "攻击速度",
    ["Settings"] = "设置",
    ["Multiple Targets"] = "多目标",
    ["Controls how many zombies kill aura targets"] = "控制自动攻击锁定的数量",
    ["Auto Look"] = "自动视角",
    ["Ignore Spawning Zombies"] = "忽略生成中的",
    ["Hit Dracula"] = "德古拉攻击",
    ["Swing Spam Count"] = "挥砍次数",
    ["Swings per tick (1-25)."] = "每刻挥砍次数（1-25）",
    ["Dracula Range"] = "德古拉范围",
    ["Attack distance (1-25 studs)."] = "攻击距离（1-25stud）",
    ["ESP"] = "ESP",
    ["Dracula ESP"] = "德古拉ESP",
    ["Silver ESP"] = "银质ESP",
    ["Players"] = "玩家",
    ["Player ESP"] = "玩家ESP",
    ["Players Chams ESP"] = "玩家透视ESP",
    ["Show Chams ESP on Players (color based on health)"] = "根据生命值显示玩家透视ESP颜色",
    ["Players Billboard ESP"] = "玩家公告板ESP",
    ["Show text ESP on Players (name, health, distance)"] = "显示玩家文本ESP（名称、生命值、距离）",
    ["Notify Low Health Players"] = "低生命值玩家提醒",
    ["Notify when players reach Low / Dying health"] = "玩家生命值过低/濒死时发出通知",
    ["Grabbed & Pinned"] = "被抓住与被压制",
    ["Notify Grabbed and Pinned Players"] = "被抓住/被压制玩家提醒",
    ["Notifies when a player is grabbed or pinned"] = "玩家被抓住或压制时发出通知",
    ["Classes"] = "职业",
    ["Medic"] = "医疗兵",
    ["Auto Request Heal Dying Players"] = "自动为濒死玩家请求治疗",
    ["Automatically requests heal for players with low health when nearby"] = "靠近低生命值玩家时自动为其请求治疗",
    ["Heal Threshold (%)"] = "治疗阈值（%）",
    ["Health percentage threshold for auto heal"] = "自动治疗的生命值百分比阈值",
    ["Sapper"] = "破坏者",
    ["Auto Repair"] = "自动修复",
    ["Auto repair's Buildings"] = "自动修复建筑",
    ["Headless Horseman"] = "无头骑士",
    ["Headless Horseman Features"] = "无头骑士功能",
    ["Aimlock Keybind"] = "自动瞄准按键",
    ["Press a key to set the aimlock keybind"] = "按一个键设置自动瞄准按键",
    ["Headless Horseman ESP"] = "无头骑士ESP",
    ["Highlight the Headless Horseman boss"] = "高亮显示无头骑士首领",
    ["Headless Horseman Aimlock"] = "无头骑士自动瞄准",
    ["Aimlock onto the Headless Horseman"] = "自动瞄准无头骑士",
    ["Prediction (Ping in ms)"] = "预判（延迟，单位：毫秒）",
    ["Adjust aimlock prediction based on your ping"] = "根据你的延迟调整自动瞄准预判",
    ["Aim Button Size"] = "瞄准按钮大小",
    ["Adjust on-screen aimlock button size"] = "调整屏幕上自动瞄准按钮的大小",
    ["Misc"] = "杂项",
    ["Movement"] = "移动",
    ["WalkSpeed"] = "行走速度",
    ["Adjust your walking speed"] = "调整你的行走速度",
    ["Apply WalkSpeed"] = "应用行走速度",
    ["force your WalkSpeed"] = "强制设置你的行走速度",
    ["JumpPower"] = "跳跃力度",
    ["Adjust your jump power"] = "调整你的跳跃力度",
    ["Infinite Jump"] = "无限跳跃",
    ["Enable or disable infinite jumping"] = "开启或关闭无限跳跃",
    ["Noclip"] = "穿墙",
    ["Walk through walls"] = "穿过墙壁行走",
    ["Visual"] = "视觉",
    ["Fullbright"] = "全亮",
    ["Remove all lighting effects"] = "移除所有光照效果",
    ["Remove Fog"] = "移除雾气",
    ["Clear all fog effects"] = "清除所有雾气效果",
    ["Server Utilities"] = "服务器工具",
    ["Rejoin Server"] = "重新加入服务器",
    ["Leave and rejoin the same game"] = "离开并重新加入同一游戏",
    ["Server Hop"] = "切换服务器",
    ["Switch to a different server"] = "切换到其他服务器",
    ["Character"] = "角色",
    ["Heal Character"] = "治疗角色",
    ["Restore health to full"] = "将生命值恢复至满值",
    ["Reset Character"] = "重置角色",
    ["Respawn your character"] = "重新生成你的角色",
    ["Feedback"] = "反馈",
    ["Send Your Feedback"] = "提交你的反馈",
    ["Why Feedback Matters"] = "反馈的重要性",
    ["Your feedback helps us improve Katchi Hub. Please be as clear and detailed as possible when submitting suggestions, bug reports, or general thoughts. All feedback will be reviewed by the developer."] = "你的反馈有助于我们改进Katchi Hub。提交建议、漏洞报告或想法时，请尽量清晰详细。所有反馈都会由开发者查看。",
    ["Feedback Message"] = "反馈信息",
    ["Enter your suggestions or issues here"] = "在此输入你的建议或问题",
    ["Write your feedback.."] = "写下你的反馈...",
    ["Submit Feedback"] = "提交反馈",
    ["Send feedback directly to the developer"] = "将反馈直接发送给开发者",
    ["Close Window"] = "关闭窗口",
    ["Do you want to close this window? You will not be able to open it again."] = "你确定要关闭此窗口吗？关闭后将无法再次打开。",
    ["Cancel"] = "取消"
}

local function translateText(text)
    if not text or type(text) ~= "string" then return text end
    if Translations[text] then return Translations[text] end
    local translated = text
    for en, cn in pairs(Translations) do
        translated = translated:gsub(en, cn)
    end
    return translated
end

local translatedElements = {}
local originalTexts = {}

local function safeTranslateElement(element)
    if translatedElements[element] then return end
    
    pcall(function()
        if element:IsA("TextLabel") or element:IsA("TextButton") or element:IsA("TextBox") then
            local currentText = element.Text
            if currentText and currentText ~= "" then
                if not originalTexts[element] then
                    originalTexts[element] = currentText
                end
                
                local translatedText = translateText(currentText)
                if translatedText ~= currentText then
                    element.Text = translatedText
                    translatedElements[element] = true
                end
            end
        end
    end)
end

local function reTranslateAllUI()
    translatedElements = {}
    for _, gui in ipairs(game:GetService("CoreGui"):GetDescendants()) do
        safeTranslateElement(gui)
    end
    local player = game:GetService("Players").LocalPlayer
    if player and player:FindFirstChild("PlayerGui") then
        for _, gui in ipairs(player.PlayerGui:GetDescendants()) do
            safeTranslateElement(gui)
        end
    end
end

local function setupSmartListener()
    local function onTextPropertyChanged(element)
        if translatedElements[element] then
            local currentText = element.Text
            local originalText = originalTexts[element]
            
            if currentText == originalText or translateText(currentText) == currentText then
                translatedElements[element] = nil
                return
            end
            
            local translatedText = translateText(currentText)
            if translatedText ~= currentText then
                element.Text = translatedText
            end
        else
            safeTranslateElement(element)
        end
    end

    local function addSmartListener(parent)
        for _, desc in ipairs(parent:GetDescendants()) do
            safeTranslateElement(desc)
        end
        parent.DescendantAdded:Connect(function(descendant)
            task.wait(0.3)
            safeTranslateElement(descendant)
            
            if descendant:IsA("TextLabel") or descendant:IsA("TextButton") or descendant:IsA("TextBox") then
                descendant:GetPropertyChangedSignal("Text"):Connect(function()
                    task.wait(0.1)
                    onTextPropertyChanged(descendant)
                end)
            end
        end)
    end
    
    pcall(addSmartListener, game:GetService("CoreGui"))
    local player = game:GetService("Players").LocalPlayer
    if player and player:FindFirstChild("PlayerGui") then
        pcall(addSmartListener, player.PlayerGui)
    end
end

local function delayedInitialTranslate()
    task.wait(5)
    reTranslateAllUI()
end

task.wait(2)
setupSmartListener()
delayedInitialTranslate()

local success, err = pcall(function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/XaviscoZ/roblox/refs/heads/main/g%26b.lua"))()
    task.wait(1.5)
    reTranslateAllUI()
end)

if not success then
    warn("加载失败:", err)
end
